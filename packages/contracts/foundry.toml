#######################################################################
#  Foundry configuration – Porfolio Rebalancer                        #
#  Values in in .envrc / GitHub Secrets                               #
#######################################################################

############################
#  Core project structure  #
############################
[profile.default]
src = "src"
out = "out"
libs = ["lib"]
test = "test"
cache = true # incremental builds
auto_detect_solc = false # pin compiler ↓
solc_version = "0.8.24" # upgrade only after audit
optimizer = true
optimizer_runs = 200 # optimized for deployment cost (reduces bytecode size)
via_ir = true # use Yul IR pipeline (smaller bytecode)
ignored_error_codes = [
    3628,
] # ignore payable fallback warnings from lib dependencies
fs_permissions = [
    { access = "read", path = "./script" },            # enable ffi read ops
    { access = "read-write", path = "./addressBook" }, # allow address book read/write
]
ffi = true
dotenv = true
#####################
#  Formatting & DX  #
#####################
bytecode_hash = "none" # deterministic hashes for diffs
ast = false            # disable AST json (speeds CI)
sparse_mode = true     # skip unchanged files
verbosity = 2          # forge test -vv

##############################
#  Forge test / fuzz config  #
##############################
gas_reports = ["*"] # enable forge gas-report for all tests
fuzz_runs = 256     # default fuzz iterations (overridden per test)
# invariant           = true      # uncomment if you start invariant suites

#######################
#  Remappings (libs)  #
#######################
remappings = [
    "@openzeppelin/=lib/openzeppelin-contracts/",
    "@openzeppelin-upgradeable/=lib/openzeppelin-contracts-upgradeable/contracts/",
    "solmate/=lib/solmate/src/",
    "forge-std/=lib/forge-std/src/",
    "@chainlink/=lib/chainlink-brownie-contracts/contracts/src/v0.8/",
    "@uniswap/v3-core/=lib/v3-core/",
    "@uniswap/v3-periphery/=lib/v3-periphery/",
]

#################################
#  Sepolia fork testing config  #
#################################
[profile.sepolia]
fork_url = "${SEPOLIA_RPC_URL}"
# fork_block_number = 10000000

#####################
#  RPC END-POINTS   #
#####################
#
#  Use `cast send --rpc-url sepolia …` or
#      `forge script … --rpc-url optimism`
#
[rpc_endpoints]
mainnet = "${MAINNET_RPC_URL}"                   # e.g. Alchemy
sepolia = "${SEPOLIA_RPC_URL}"
base = "${BASE_RPC_URL}"
base-sepolia = "${BASE_SEPOLIA_RPC_URL}"
polygon = "${POLYGON_RPC_URL}"
mumbai = "${MUMBAI_RPC_URL}"
arbitrum = "${ARBITRUM_RPC_URL}"
arbitrum-sepolia = "${ARBITRUM_SEPOLIA_RPC_URL}"
optimism = "${OPTIMISM_RPC_URL}"
optimism-sepolia = "${OPTIMISM_SEPOLIA_RPC_URL}"
avalanche = "${AVALANCHE_RPC_URL}"
fuji = "${FUJI_RPC_URL}"
bsc = "${BSC_RPC_URL}"
bsc-testnet = "${BSC_TEST_RPC_URL}"

###########################
#  Explorer verification  #
###########################
#
#  `forge script … --broadcast --verify` picks the
#  API key based on the chain-id of --rpc-url.
#
[etherscan]
1 = { key = "${ETHERSCAN_API_KEY}" }         # Ethereum Mainnet
11155111 = { key = "${ETHERSCAN_API_KEY}" }  # Sepolia Testnet
137 = { key = "${POLYGONSCAN_API_KEY}" }     # Polygon Mainnet
80001 = { key = "${POLYGONSCAN_API_KEY}" }   # Mumbai Testnet
42161 = { key = "${ARBISCAN_API_KEY}" }      # Arbitrum One
421614 = { key = "${ARBISCAN_API_KEY}" }     # Arbitrum Sepolia
10 = { key = "${OPTIMISTIC_API_KEY}" }       # Optimism Mainnet
11155420 = { key = "${OPTIMISTIC_API_KEY}" } # Optimism Sepolia
8453 = { key = "${BASESCAN_API_KEY}" }       # Base Mainnet
84532 = { key = "${BASESCAN_API_KEY}" }      # Base Sepolia

#########################
#  Forge script params  #
#########################
# These make `forge script` invocations shorter; you can still
# override with CLI flags on CI or locally.
# eth_rpc_url = "${SEPOLIA_RPC_URL}"
# block_gas_limit = 30000000
# private_key = "${PRIVATE_KEY}" # never commit!  set in CI env
